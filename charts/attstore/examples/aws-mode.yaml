# Example: AWS Deployment Mode
# Cloud-native deployment using AWS managed services (RDS, S3)

replicaCount: 2

# IMPORTANT: Configure IRSA for S3 access
serviceAccount:
  create: true
  annotations:
    eks.amazonaws.com/role-arn: "arn:aws:iam::123456789012:role/attstore-s3-access"  # REQUIRED: Your IAM role ARN

# IMPORTANT: Set these secrets (use AWS Secrets Manager recommended)
config:
  sessionSecret: ""  # REQUIRED
  jwtSecretKey: ""   # REQUIRED
  admin:
    password: ""  # REQUIRED
    email: "admin@company.com"

# AWS ALB Ingress
ingress:
  enabled: true
  className: "alb"
  annotations:
    alb.ingress.kubernetes.io/scheme: internet-facing
    alb.ingress.kubernetes.io/target-type: ip
    alb.ingress.kubernetes.io/listen-ports: '[{"HTTP": 80}, {"HTTPS": 443}]'
    alb.ingress.kubernetes.io/ssl-redirect: '443'
    alb.ingress.kubernetes.io/certificate-arn: "arn:aws:acm:us-east-1:123456789012:certificate/xxxxx"  # REQUIRED
    alb.ingress.kubernetes.io/healthcheck-path: /healthz
  hosts:
    - host: attstore.company.com
      paths:
        - path: /
          pathType: Prefix

# Production resources
resources:
  limits:
    cpu: 1000m
    memory: 1Gi
  requests:
    cpu: 250m
    memory: 512Mi

# Enable autoscaling
autoscaling:
  enabled: true
  minReplicas: 2
  maxReplicas: 10
  targetCPUUtilizationPercentage: 70

# Multi-AZ pod distribution
affinity:
  podAntiAffinity:
    preferredDuringSchedulingIgnoredDuringExecution:
    - weight: 100
      podAffinityTerm:
        labelSelector:
          matchExpressions:
          - key: app.kubernetes.io/name
            operator: In
            values:
            - attstore
        topologyKey: topology.kubernetes.io/zone

# AWS S3 storage
storage:
  type: CLOUD_STORAGE
  persistence:
    enabled: false
  cloudStorage:
    provider: AWS
    aws:
      bucket: "my-attstore-bucket"  # REQUIRED: Your S3 bucket
      region: "us-east-1"  # REQUIRED: Your AWS region
      # No credentials needed when using IRSA

# External RDS PostgreSQL
database:
  type: postgresql
  postgresql:
    enabled: false  # Using external RDS
  externalDatabase:
    enabled: true
    host: "attstore-db.xxxxx.us-east-1.rds.amazonaws.com"  # REQUIRED: Your RDS endpoint
    port: 5432
    database: "attstoredb"
    username: "attstoreuser"
    password: ""  # REQUIRED: Set via --set or external-secrets

# Disable MinIO (using S3)
minio:
  enabled: false

# Disable PgBouncer (can use RDS Proxy instead)
pgbouncer:
  enabled: false

# Enable pod disruption budget
podDisruptionBudget:
  enabled: true
  minAvailable: 1
